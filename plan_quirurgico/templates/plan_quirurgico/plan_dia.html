{% extends request.session.template_base %}

{% load staticfiles %}
{% load custom_filters %}
{% load widget_tweaks %}

{% block title %}{{ block.super }} | Plan Día {% endblock title %}

{% block scripts %}
<script type="text/javascript" src="{% static 'plan_quirurgico/js/plan_dia.js' %}">
</script>
<script type="text/javascript" src="{% static 'plan_quirurgico/js/drag-on.js' %}">
</script>
<script type="text/javascript" src="{% static 'medico/js/detalles_operacion.js' %}">
</script>
{% endblock scripts %}

{% block nombre-usuario %}
{{ request.session.nombre }}
{% endblock nombre-usuario %}

{% block numero-mensajes %}
3
{% endblock numero-mensajes %}

{% block content %}

<div class="page-header">
	<h1>
		<a href="{% url 'calendario' area_actual ano mes %}">
			<span class="glyphicon glyphicon-chevron-left">
			</span>
			Plan Quirúrgico
		</a>
		<small> - {{ area_nombre }} - {{ dia }}/{{ mes }}/{{ ano }}</small>
		<small class="pull-right">
			<button class="btn btn-primary" id="btn-solicitar-quirofano" data-toggle="modal" data-target="#solicitar-quirofano">
				{{ SOLICITAR_QUIROFANO }}
			</button>
		</small>
	</h1>
</div>

<!-- Aviso Seleccionar Turno Intervencion -->
<div class="row">
	<div class="col-lg-10 col-lg-offset-1 well well-warning hidden" id="duracion-intervencion-aviso">
		<strong>
			{{ LABEL_DURACION_INTERVENCION }} {{ horas_intervencion }} {{ HORAS }} {{ minutos_intervencion }} {{ MINUTOS }}
		</strong>
		<p class="text-muted">
			<strong>{{ MENSAJE_SELECCIONAR_TURNO_INTERVENCION }}</strong>
		</p>
		<a href="{% url 'plan_dia' area_actual ano mes dia %}" class="btn btn-default pull-right">{{ CANCELAR }}</a>
	</div>
</div><br><!-- Aviso Seleccionar Turno Intervencion -->

{% if seleccionar_turno %}
<script type="text/javascript">
$(function(){
	mostrarAvisoSeleccionarTurnoIntervencion();
});
</script>
{% endif %}

<!-- Modal de la Duracion de la Operacion -->
<div class="modal fade" id="solicitar-quirofano" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
					&times;
				</button>
				<h4 class="modal-title" id="myModalLabel">
					Duración de la Intervención Quirúrgica
				</h4>
			</div>
			<form role="form" class="form-horizontal col-lg-offset-1" action="{% url 'plan_dia' area_actual ano mes dia %}" method="POST" novalidate>
				<div class="modal-body">
					{% csrf_token %}
					{% if formulario_duracion_intervencion_quirurgica.errors %}
					<script type="text/javascript">
					$(function(){
						mostrarModalFormularioDuracionIntervencionQuirurgica();
					});
					</script>
					{% endif %}
					<div class="form-group" id="duracion-form-group">
						<label class="col-lg-2 control-label" for="duracion-horas">
							<span class="glyphicon glyphicon-time">
							</span>
							{{ LABEL_HORAS }}
						</label>
						<div class="col-lg-3">
							{% render_field formulario_duracion_intervencion_quirurgica.horas class="form-control" id="duracion-horas" %}
							<span class="glyphicon glyphicon-remove form-control-feedback hidden" id="duracion-horas-error-feedback-icon"></span>
							<span class="help-block hidden" id="duracion-horas-error-help">{{ formulario_duracion_intervencion_quirurgica.horas.errors }}</span>
						</div>
						<label class="col-lg-2 control-label" for="duracion-minutos">
							<span class="glyphicon glyphicon-time">
							</span>
							{{ LABEL_MINUTOS }}
						</label>
						<div class="col-lg-3">
							{% render_field formulario_duracion_intervencion_quirurgica.minutos class="form-control" id="duracion-minutos" %}
							<span class="glyphicon glyphicon-remove form-control-feedback hidden" id="duracion-minutos-error-feedback-icon"></span>
							<span class="help-block hidden" id="duracion-minutos-error-help">{{ formulario_duracion_intervencion_quirurgica.minutos.errors }}</span>
						</div>
						{% if formulario_duracion_intervencion_quirurgica.horas.errors %}
						<script type="text/javascript">
						$(function(){
							mostrarErroresDuracionHoras();
						});
						</script>
						{% endif %}
						{% if formulario_duracion_intervencion_quirurgica.minutos.errors %}
						<script type="text/javascript">
						$(function(){
							mostrarErroresDuracionMinutos();
						});
						</script>
						{% endif %}
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">
						{{ CANCELAR }}
					</button>
					<button type="submit" id="aceptar-duracion" class="btn btn-primary">
						{{ ACEPTAR }}
					</button>
				</div>
			</form>
		</div>
	</div>
</div><!-- Modal de la Duracion de la Operacion -->

<!-- Modal del Detalle de la Operacion -->
<div class="modal fade" id="detalle-operacion" tabindex="-1" role="dialog" aria-labelledby="titulo-detalles-operacion" aria-hidden="true">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
					&times;
				</button>
				<h4 class="modal-title" id="titulo-detalles-operacion">
					Detalles de Operación - Quirófano
				</h4>
			</div>
			<div class="modal-body">
				<form class="form-horizontal" role="form" id="formulario-solicitud-quirofano">
					<div class="form-group">
						<label class="col-lg-2 control-label">
							Área:
						</label>
						<div class="col-lg-2">
							<input class="form-control" type="text" value="Quirúrgica" disabled>
						</div>
						<label class="col-lg-2 control-label">
							Quirófano:
						</label>
						<div class="col-lg-2">
							<input class="form-control" type="text" value="Quirófano 4" disabled>
						</div>
						<label class="col-lg-2 control-label">
							Fecha:
						</label>
						<div class="col-lg-2">
							<input class="form-control" type="text" value="14/03/2014" disabled>
						</div>
					</div>
					<div class="form-group">
						<label class="col-lg-2 control-label">
							Hora Inicio:
						</label>
						<div class="col-lg-2">
							<input class="form-control" type="text" value="8:30am" disabled>
						</div>
						<label class="col-lg-2 control-label">
							Hora Fin:
						</label>
						<div class="col-lg-2">
							<input class="form-control" type="text" value="10:30am" disabled>
						</div>
					</div>
					<div class="form-group">
						<label class="col-lg-2 control-label" for="tipo-solicitud">
							Tipo:
						</label>
						<div class="col-lg-10">
							<div class="radio-inline">
								<label>
									<input type="radio" name="tipo-solicitud" value="emergencia" disabled>
									Emergencia
								</label>
							</div>
							<div class="radio-inline">
								<label>
									<input type="radio" name="tipo-solicitud" value="electiva" checked disabled>
									Electiva
								</label>
							</div>
							<div class="radio-inline">
								<label>
									<input type="radio" name="tipo-solicitud" value="paliativa" disabled>
									Paliativa
								</label>
							</div>
						</div>
					</div>
					<div class="form-group">
						<label class="col-lg-2 control-label" for="tipo-operacion">
							Operación:
						</label>
						<div class="col-lg-10">
							<select class="form-control" name="tipo-operacion" disabled>
								<option>
									Reducción Gastrica
								</option>
								<option>
									Liposucción
								</option>
								<option>
									Intervención Cardíaca
								</option>
							</select>
						</div>
					</div>
					<div class="form-group">
						<label class="col-lg-2 control-label" for="tipo-anestesia">
							Anestesia:
						</label>
						<div class="col-lg-10">
							<select class="form-control" name="tipo-anestesia" disabled>
								<option>
									General
								</option>
								<option>
									Local
								</option>
							</select>
						</div>
					</div>
					<div class="form-group">
						<label class="col-lg-2 control-label" for="observaciones">
							Observaciones:
						</label>
						<div class="col-lg-10">
							<textarea class="form-control" name="observaciones" rows="3" disabled></textarea>
						</div>
					</div>
					<div class="form-group">
						<label class="col-lg-2 control-label" for="riesgo">
							Nivel de Riesgo:
						</label>
						<div class="col-lg-10">
							<div class="radio-inline">
								<label>
									<input type="radio" name="riesgo" value="bueno" disabled>
									Bueno
								</label>
							</div>
							<div class="radio-inline">
								<label>
									<input type="radio" name="riesgo" value="regular" checked disabled>
									Regular
								</label>
							</div>
							<div class="radio-inline">
								<label>
									<input type="radio" name="riesgo" value="malo" disabled>
									Malo
								</label>
							</div>
						</div>
					</div>
					<div class="form-group hidden" id="razon-riesgo">
						<div class="col-lg-offset-2 col-lg-10">
							<textarea class="form-control" id="razon-riesgo-input" name="razon" rows="3" placeholder="Indique razón del riesgo" disabled></textarea>
						</div>
					</div>
					<div class="form-group">
						<label class="col-lg-2 control-label" for="equipo-especial-requerido">
							Equipos
							<abbr title="Especiales">
								Esp.
							</abbr>:
						</label>
						<div class="col-lg-10">
							<select multiple class="form-control" name="equipo-especial-requerido" disabled>
								<option>
									1
								</option>
								<option>
									2
								</option>
								<option>
									3
								</option>
								<option>
									4
								</option>
							</select>
						</div>
					</div>
					<div class="form-group">
						<label class="col-lg-2 control-label" for="material-quirurgico">
							Material
							<abbr title="Quirúrgico">
								Quir.
							</abbr>:
						</label>
						<div class="col-lg-10">
							<label class="checkbox-inline">
								<input type="checkbox" name="material-quirurgico" disabled>
								Sutura Especial
							</label>
							<label class="checkbox-inline">
								<input type="checkbox" name="material-quirurgico" disabled>
								Protack
							</label>
							<label class="checkbox-inline">
								<input type="checkbox" name="material-quirurgico" disabled>
								Malla Polipropileno
							</label>
							<label class="checkbox-inline">
								<input type="checkbox" name="material-quirurgico" disabled>
								Malla Dual Mesh
							</label>
							<label class="checkbox-inline">
								<input type="checkbox" name="material-quirurgico" disabled>
								Máquina de Autosutura
							</label>
						</div>
					</div>
					<div class="form-group">
						<div class="col-lg-offset-10">							<a href="javascript:void(0);" class="btn btn-default" id="ver-info-paciente">
							Paciente
							<span class="glyphicon glyphicon-chevron-right">
							</span>
						</a>
					</div>
				</form><!-- Formulario Solicitud Quirofano -->

				<form class="form-horizontal hidden" role="form" id="formulario-solicitud-paciente">
					<div class="form-group">
						<label class="col-lg-2 control-label" for="nombre-paciente">
							Nombre:
						</label>
						<div class="col-lg-4">
							<input type="text" class="form-control" name="nombre-paciente" value="Enrique" disabled>
						</div>
						<label class="col-lg-2 control-label" for="apellido-paciente">
							Apellido:
						</label>
						<div class="col-lg-4">
							<input type="text" class="form-control" name="apellido-paciente" value="Mata" disabled>
						</div>
					</div><!-- Nombre y Apellido -->
					<div class="form-group">
						<label class="col-lg-2 control-label" for="cedula-paciente">
							Cedula:
						</label>
						<div class="col-lg-4">
							<input type="text" class="form-control" name="cedula-paciente" value="19803052" disabled>
						</div>
						<label class="col-lg-2 control-label" for="fecha-nacimiento-paciente">
							Fecha
							<abbr title="Nacimiento">
								Nac.
							</abbr>:
						</label>
						<div class="col-lg-4">
							<input type="date" class="form-control" name="fecha-nacimiento-paciente" disabled>
						</div>
					</div><!-- Cedula y Fecha de Nacimiento -->
					<div clas="form-group">
						<label class="col-lg-2 control-label" for="sexo-paciente">
							Sexo:
						</label>
						<div class="col-lg-10">
							<div class="radio-inline">
								<label>
									<input type="radio" name="sexo-paciente" value="M" checked disabled>
									Masculino
								</label>
							</div>
							<div class="radio-inline">
								<label>
									<input type="radio" name="sexo-paciente" value="F" disabled>
									Femenino
								</label>
							</div>
						</div>
					</div><!-- Sexo -->
					<div class="form-group">
						<label class="col-lg-2 control-label" for="telefono-paciente">
							Teléfono:
						</label>
						<div class="col-lg-2">
							<input type="text" class="form-control" value="424" disabled>
						</div>
						<div class="col-lg-3">
							<input type="text" class="form-control" name="telefono-paciente" value="1587765" disabled>
						</div>
					</div><!-- Telefono -->
					<div class="form-group">
						<label class="col-lg-2 control-label" for="diagnostico-ingreso-paciente">
							Diagnóstico:
						</label>
						<div class="col-lg-10">
							<textarea class="form-control" name="diagnostico-ingreso-paciente" rows="3" disabled>Obesidad</textarea>
						</div>
					</div><!-- Diagnostico -->
					<div clas="form-group">
						<label class="col-lg-2 control-label" for="forma-pago">
							Forma de Pago:
						</label>
						<div class="col-lg-10">
							<div class="radio-inline">
								<label>
									<input type="radio" name="forma-pago" value="particular" checked disabled>
									Particular
								</label>
							</div>
							<div class="radio-inline">
								<label>
									<input type="radio" name="forma-pago" value="seguro" disabled>
									Seguro
								</label>
							</div>
						</div>
					</div><!-- Forma de Pago -->
					<div class="form-group hidden" id="seguros">
						<label class="col-lg-2 control-label" for="compania-aseguradora">
							Aseguradora:
						</label>
						<div class="col-lg-10">
							<select class="form-control" name="compania-aseguradora" disabled>
								<option>
									Seguros Altamira
								</option>
								<option>
									Seguros Mercantil
								</option>
							</select>
						</div>
					</div><!-- Seguros -->
					<div class="form-group">
						<div class="col-lg-offset-2 col-lg-4">
							<label class="checkbox-inline">
								<input type="checkbox" name="paciente-hospitalizado" disabled>
								Paciente Hospitalizado
							</label>
						</div>
						<div class="hidden" id="habitacion">
							<label class="col-lg-2 control-label" for="paciente-hospitalizado-habitacion">
								Habitación:
							</label>
							<div class="col-lg-4">
								<select class="form-control" name="paciente-hospitalizado-habitacion" disabled>
									<option>
										hab1
									</option>
									<option>
										hab2
									</option>
									<option>
										hab3
									</option>
								</select>
							</div>
						</div>
					</div><!-- Paciente Hospitalizado -->
					<div class="form-group">
						<div class="col-lg-offset-2 col-lg-4">
							<label class="checkbox-inline control-label">
								<input type="checkbox" name="paciente-impres" disabled>
								Paciente Suscrito a Impres
							</label>
						</div>
						<div class="col-lg-6 hidden" id="carnet-impres">
							<input type="text" class="form-control" name="carnet-impres" placeholder="Indique carnet impres" disabled>
						</div>
					</div><!-- Paciente Impres -->
					<div class="form-group">
						<div class="col-lg-offset-2 col-lg-4">
							<label class="checkbox-inline control-label">
								<input type="checkbox" name="paciente-medico" disabled>
								Paciente Médico
							</label>
						</div>
						<div class="col-lg-6 hidden" id="numero-inscripcion-medico">
							<input type="text" class="form-control" name="numero-inscripcion-medico" placeholder="Indique numero de inscripcion" disabled>
						</div>
					</div><!-- Paciente Medico -->
					<div class="form-group">
						<div class="col-lg-offset-2 col-lg-10">
							<label class="checkbox-inline control-label">
								<input type="checkbox" name="paciente-pariente-medico" disabled>
								Paciente Pariente de Médico
							</label>
						</div>
					</div><!-- Paciente Pariente Medico -->
					<div class="form-group hidden" id="medico-pariente">
						<label class="col-lg-offset-2 col-lg-2 control-label" for="nombre-medico-pariente">
							Indique Médico:
						</label>
						<div class="col-lg-3">
							<input type="text" class="form-control input-medico-pariente" name="nombre-medico-pariente" placeholder="Nombre" disabled>
						</div>
						<div class="col-lg-3">
							<input type="text" class="form-control input-medico-pariente" name="apellido-medico-pariente" placeholder="Apellido" disabled>
						</div>
						<div class="col-lg-2">
							<input type="text" class="form-control input-medico-pariente" name="cedula-medico-pariente" placeholder="Cédula" disabled>
						</div>
					</div><!-- Paciente Pariente de Medico -->
					<div class="form-group">
						<div class="col-lg-2">
							<a href="javascript:void(0);" class="btn btn-default" id="volver-info-quirofano">
								<span class="glyphicon glyphicon-chevron-left">
								</span>
								Quirófano
							</a>
						</div>
						<div class="col-lg-offset-10">
							<a href="javascript:void(0);" class="btn btn-default" id="ver-info-honorarios">
								Honorarios
								<span class="glyphicon glyphicon-chevron-right">
								</span>
							</a>
						</div>
					</div>
				</form><!-- Formulario Solicitud Paciente -->

				<form class="form-horizontal hidden" role="form" id="formulario-solicitud-honorarios">
					<div class="form-group">
						<label class="col-lg-2 control-label" for="nombre-anestesiologo">
							Anestesiólogo:
						</label>
						<div class="col-lg-3">
							<input type="text" class="form-control" name="nombre-anestesiologo" value="Juan" disabled>
						</div>
						<div class="col-lg-3">
							<input type="text" class="form-control" name="apellido-anestesiologo" value="Requesens" disabled>
						</div>
						<div class="col-lg-4">
							<div class="input-group">
								<span class="input-group-addon">
									Bs.
								</span>
								<input type="text" class="form-control" name="honorario-anestesiologo" value="10.000" disabled>
							</div>
						</div>
					</div><!-- Anestesiologo -->
					<div class="form-group">
						<label class="col-lg-2 control-label" for="nombre-ayudante-1">
							Primer Ayudante:
						</label>
						<div class="col-lg-3">
							<input type="text" class="form-control" name="nombre-ayudante-1" value="Juan" disabled>
						</div>
						<div class="col-lg-3">
							<input type="text" class="form-control" name="apellido-ayudante-1" value="Pirela" disabled>
						</div>
						<div class="col-lg-4">
							<div class="input-group">
								<span class="input-group-addon">
									Bs.
								</span>
								<input type="text" class="form-control" name="honorario-ayudante-1" value="10.000" disabled>
							</div>
						</div>
					</div><!-- Primer Ayudante -->
					<div class="form-group">
						<label class="col-lg-2 control-label" for="nombre-ayudante-2">
							Segundo Ayudante:
						</label>
						<div class="col-lg-3">
							<input type="text" class="form-control" name="nombre-ayudante-2" value="Juan" disabled>
						</div>
						<div class="col-lg-3">
							<input type="text" class="form-control" name="apellido-ayudante-2" value="Ramos" disabled>
						</div>
						<div class="col-lg-4">
							<div class="input-group">
								<span class="input-group-addon">
									Bs.
								</span>
								<input type="text" class="form-control" name="honorario-ayudante-2" value="10.000" disabled>
							</div>
						</div>
					</div><!-- Segundo Ayudante -->
					<div class="form-group">
						<label class="col-lg-2 control-label" for="nombre-ayudante-3">
							Tercer Ayudante:
						</label>
						<div class="col-lg-3">
							<input type="text" class="form-control" name="nombre-ayudante-3" value="Armando" disabled>
						</div>
						<div class="col-lg-3">
							<input type="text" class="form-control" name="apellido-ayudante-3" value="Casas" disabled>
						</div>
						<div class="col-lg-4">
							<div class="input-group">
								<span class="input-group-addon">
									Bs.
								</span>
								<input type="text" class="form-control" name="honorario-ayudante-3" value="10.000" disabled>
							</div>
						</div>
					</div><!-- Tercer Ayudante -->
					<div class="form-group">
						<div class="col-lg-2">
							<a href="javascript:void(0);" class="btn btn-default" id="volver-info-paciente">
								<span class="glyphicon glyphicon-chevron-left">
								</span>
								Paciente
							</a>
						</div>
					</div>
				</form><!-- Formulario Solicitud Honorarios -->
			</div>
		</div>
	</div>
</div>
</div><!-- Modal del Detalle de la Operacion -->

<!-- Plan Quirurgico por Dia -->
<div class="row">
	<div class="col-lg-1 col-lg-offset-1">
		<table class="table table-bordered table-responsive table-horas">
			<thead>
				<tr>
					<th>
						<span class="glyphicon glyphicon-time">
						</span>
					</th>
				</tr>
			</thead>
			<tbody>
				{% for media_hora_legible in medias_horas_legibles %}
				<tr><td> {{ media_hora_legible }} </td></tr>
				{% endfor %}
			</tbody>
		</table>
	</div>

	<div class="col-lg-9 scrollable-plan dragon">
		<table class="table table-bordered table-hover table-responsive table-plan">
			<thead>
				<tr>
					{% for quirofano in quirofanos %}
					<th>{{ quirofano.nombre }}</th>
					{% endfor %}
				</tr>
			</thead>
			<tbody>
				{% for media_hora in medias_horas %}
				<tr>
					{% for quirofano in quirofanos %}
					{% if quirofano.intervenciones %}
					{% if media_hora in quirofano.intervenciones.keys %}
					{% with quirofano.intervenciones|valor_clave:media_hora as intervencion %}
					{% with quirofano.intervenciones.values|ocurrencias:intervencion as duracion %}
					{% if intervencion.obtener_hora_inicio_horas == media_hora %}
					<td class="unavailable" data-togle="tooltip" data-placement="right" title="{{ quirofano.nombre }}" rowspan="{{ duracion }}">
						<a href="#" class="pull-right" data-toggle="modal" data-target="#">
							<span class="glyphicon glyphicon-fullscreen"></span>
						</a>
						<p class="label label-info">
							{{ LABEL_PACIENTE }} {{ intervencion.paciente }}
						</p><br>
						<p class="label label-default">
							{{ LABEL_MEDICO }} {{ intervencion.reservacion.medico }}
						</p>
					</td>
					{% endif %}
					{% endwith %}
					{% endwith %}
					{% else %}
					{% if seleccionar_turno %}
					{% if media_hora in quirofano.turnos_disponibles %}
					<td class="available available-select" data-toogle="tooltip" data-placement="right" title="{{ quirofano.nombre }}" rowspan="{{ cantidad_medias_horas_intervencion }}">
							<a class="btn btn-primary" href="#">
								{{ SELECCIONAR_TURNO }}
							</a>
					</td>
					{% elif media_hora in quirofano.medias_horas_disponibles_atravesadas %}
					<td data-toogle="tooltip" data-placement="right" title="{{ quirofano.nombre }}">
					</td>
					{% endif %}
					{% else %}
					<td class="available" data-toogle="tooltip" data-placement="right" title="{{ quirofano.nombre }}">
					</td>
					{% endif %}
					{% endif %}
					{% else %}
					{% if seleccionar_turno %}
					{% if media_hora in quirofano.turnos_disponibles %}
					<td class="available available-select" data-toogle="tooltip" data-placement="right" title="{{ quirofano.nombre }}" rowspan="{{ cantidad_medias_horas_intervencion }}">
							<a class="btn btn-primary" href="#">
								{{ SELECCIONAR_TURNO }}
							</a>
					</td>
					{% elif media_hora in quirofano.medias_horas_disponibles_atravesadas %}
					<td data-toogle="tooltip" data-placement="right" title="{{ quirofano.nombre }}">
					</td>
					{% endif %}
					{% else %}
					<td class="available" data-toogle="tooltip" data-placement="right" title="{{ quirofano.nombre }}">
					</td>
					{% endif %}
					{% endif %}
					{% endfor %}
				</tr>
				{% endfor %}
			</tbody>
		</table>
	</div>

	<div class="col-lg-1">
		<table class="table table-help">
			<thead>
				<th>
				</th>
			</thead>
			<tbody>
				<tr>
					<td>
						<p class="label label-available">{{ DISPONIBLE }}</p>
						<p class="label label-unavailable">{{ NO_DISPONIBLE }}</p>
					</td>
				</tr>
			</tbody>
		</table>
	</div>
</div><!-- Plan Quirurgico por Dia -->
{% endblock content %}
